{% extends "base.html" %}
{% block content %}
<h4 class="section-title">Chat-style Voice Assistant / ‡¥∂‡¥¨‡µç‡¥¶ ‡¥ö‡¥æ‡¥±‡µç‡¥±‡µç ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø</h4>

<style>
  .chat-container {
    background: #0f172a;
    border-radius: 1rem;
    padding: 1rem;
    color: #e5e7eb;
  }
  .chat-window {
    max-height: 420px;
    overflow-y: auto;
    padding-right: 0.5rem;
  }
  .message-row {
    margin-bottom: 0.75rem;
    display: flex;
  }
  .message-user {
    justify-content: flex-end;
  }
  .message-assistant {
    justify-content: flex-start;
  }
  .bubble {
    max-width: 80%;
    padding: 0.55rem 0.8rem;
    border-radius: 0.75rem;
    font-size: 0.9rem;
    white-space: pre-wrap;
  }
  .bubble-user {
    background: #22c55e;
    color: #022c22;
    border-bottom-right-radius: 0.2rem;
  }
  .bubble-assistant {
    background: #111827;
    border: 1px solid #1f2937;
    border-bottom-left-radius: 0.2rem;
  }
  .chat-input-bar {
    background: #020617;
    border-radius: 999px;
    padding: 0.35rem 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }
  .chat-input-bar input {
    border: none;
    background: transparent;
    color: #e5e7eb;
    width: 100%;
    outline: none;
    font-size: 0.9rem;
  }
  .icon-button {
    border-radius: 999px;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.3rem;
    height: 2.3rem;
    padding: 0;
    font-size: 1rem;
  }
  .icon-button-send {
    background: #22c55e;
    color: #022c22;
  }
  .icon-button-mic {
    background: #0f172a;
    color: #e5e7eb;
    border: 1px solid #1e293b;
  }
</style>

<div class="chat-container">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="small text-muted">Language for voice (Malayalam / English):</div>
    <select id="languageSelect" class="form-select form-select-sm" style="width:auto;">
      <option value="ml-IN">Malayalam (ml-IN)</option>
      <option value="en-IN">English (en-IN)</option>
    </select>
  </div>

  <div id="chatWindow" class="chat-window mb-2">
    <!-- Messages will be appended here dynamically -->
  </div>

  <div class="chat-input-bar">
    <input id="userInput" type="text" placeholder="Ask about crops, weather, soil, schemes..." autocomplete="off" />
    <button id="micBtn" class="icon-button icon-button-mic" title="Voice input">
      üéô
    </button>
    <button id="sendBtn" class="icon-button icon-button-send" title="Send">
      ‚û§
    </button>
  </div>
</div>

<script>
  // Rule-based bilingual (Malayalam + English) reply generator.
  function generateReply(text) {
    const lower = text.toLowerCase();

    // Weather / rain related
    if (lower.includes('weather') || lower.includes('‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥•')) {
      return '‡¥á‡¥®‡µç‡¥®‡µç ‡¥ö‡¥ø‡¥≤ ‡¥á‡¥ü‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡¥≤‡¥æ‡¥Ø‡¥ø ‡¥Æ‡¥¥‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§‡¥Ø‡µÅ‡¥£‡µç‡¥ü‡µç. ‡¥µ‡¥Ø‡¥≤‡¥ø‡µΩ ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥ø‡¥ü‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥Ö‡¥µ‡¥∏‡µç‡¥• ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï, ‡¥á‡¥≤‡¥ï‡¥≥‡¥ø‡µΩ ‡¥™‡¥æ‡¥ü‡µÅ‡¥ï‡µæ ‡¥â‡¥£‡µç‡¥ü‡µã‡¥®‡µç‡¥®‡µç ‡¥®‡µã‡¥ï‡µç‡¥ï‡¥ø ‡¥∞‡µã‡¥ó‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.\nToday there is a chance of scattered showers. Avoid waterlogging and watch for fungal diseases.';
    }

    // Crop choice / which crop to grow
    if (
      lower.includes('which crop') ||
      lower.includes('best crop') ||
      lower.includes('what to plant') ||
      lower.includes('crop for my land') ||
      lower.includes('‡¥è‡¥§‡µç ‡¥µ‡¥ø‡¥≥') || lower.includes('‡¥è‡¥§‡µÅ ‡¥µ‡¥ø‡¥≥') ||
      lower.includes('‡¥µ‡¥ø‡¥≥ ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥Ç')
    ) {
      return '‡¥µ‡¥ø‡¥≥ ‡¥§‡µÜ‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡¥ø‡¥®‡µç ‡¥á‡¥ü‡¥§‡µç ‡¥µ‡¥∂‡¥§‡µç‡¥§‡µÅ‡¥≥‡µç‡¥≥ "Crop Advisor" ‡¥Æ‡µã‡¥°‡µç‡¥Ø‡µÇ‡µæ ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï. ‡¥Ö‡¥§‡µç ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡¥∞‡¥Ç, ‡¥ú‡¥ø‡¥≤‡µç‡¥≤, ‡¥µ‡¥ø‡¥∏‡µç‡¥§‡µÄ‡µº‡¥£‡¥Ç, ‡¥ï‡¥æ‡¥≤‡¥Ç ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ ‡¥ö‡µã‡¥¶‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥Ö‡¥®‡µÅ‡¥Ø‡µã‡¥ú‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥µ‡¥ø‡¥≥ ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç.\nFor crop selection, please open the "Crop Advisor" module on the left. It will ask soil type, district, land size and season and suggest suitable crops.';
    }

    // Banana specific
    if (lower.includes('banana') || lower.includes('‡¥µ‡¥æ‡¥¥')) {
      return '‡¥µ‡¥æ‡¥¥‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µç ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥ø‡¥ü‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡¥£‡¥Ç. ‡¥®‡¥≤‡µç‡¥≤ ‡¥ú‡µà‡¥µ‡¥µ‡¥≥‡¥Ç ‡¥ï‡µÇ‡¥ü‡µÜ ‡¥∂‡µÅ‡¥™‡¥æ‡µº‡¥∂ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥® ‡¥é‡µª‡¥™‡¥ø‡¥ï‡µÜ (NPK) ‡¥Ö‡¥≥‡¥µ‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.\nFor banana, avoid waterlogging and apply organic manure along with recommended NPK dose.';
    }

    // Paddy / rice specific
    if (lower.includes('paddy') || lower.includes('‡¥®‡µá‡µΩ')) {
      return '‡¥®‡µá‡µΩ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥µ‡¥Ø‡µΩ ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥≤‡µÜ‡¥µ‡µΩ ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µÅ 2-3 ‡¥∏‡µÜ.‡¥Æ‡µÄ. ‡¥â‡¥Ø‡¥∞‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥®‡¥ø‡¥≤‡¥®‡¥ø‡µº‡¥§‡µç‡¥§‡¥£‡¥Ç.\nFor paddy, ensure proper field leveling and maintain 2-3 cm water depth during vegetative stage.';
    }

    // Soil / fertilizer / manure questions
    if (
      lower.includes('fertilizer') || lower.includes('fertiliser') ||
      lower.includes('manure') || lower.includes('npk') ||
      lower.includes('soil') || lower.includes('pH') ||
      lower.includes('‡¥µ‡¥≥‡¥Ç') || lower.includes('‡¥Æ‡¥£‡µç‡¥£‡µç')
    ) {
      return '‡¥µ‡¥≥‡¥Ç ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡¥ø‡¥®‡µç "Soil & Fertilizer" ‡¥Æ‡µã‡¥°‡µç‡¥Ø‡µÇ‡µæ ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï. ‡¥µ‡¥ø‡¥≥, ‡¥ú‡µà‡¥µ ‡¥µ‡¥∏‡µç‡¥§‡µÅ ‡¥®‡¥ø‡¥≤, ‡¥µ‡¥ø‡¥∏‡µç‡¥§‡µÄ‡µº‡¥£‡¥Ç ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ ‡¥®‡µΩ‡¥ï‡¥ø ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø NPK ‡¥Ö‡¥≥‡¥µ‡µç ‡¥ï‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥Ç.\nFor fertilizer and soil health, use the "Soil & Fertilizer" module. Enter crop, organic matter level and land size to get an approximate NPK dose and organic options.';
    }

    // Irrigation / water questions
    if (
      lower.includes('irrigation') || lower.includes('water') ||
      lower.includes('watering') ||
      lower.includes('‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥®‡¥Ç') || lower.includes('‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç')
    ) {
      return '‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥®‡¥ï‡µç‡¥∞‡¥Æ‡¥§‡µç‡¥§‡¥ø‡¥®‡µç "Irrigation" ‡¥Æ‡µã‡¥°‡µç‡¥Ø‡µÇ‡µæ ‡¥§‡µÅ‡¥±‡¥ï‡µç‡¥ï‡µÅ‡¥ï. ‡¥µ‡¥ø‡¥≥, ‡¥µ‡¥≥‡µº‡¥ö‡µç‡¥ö‡¥æ ‡¥ò‡¥ü‡µç‡¥ü‡¥Ç, ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡¥∞‡¥Ç, ‡¥Æ‡¥¥ ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§ ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ ‡¥®‡µΩ‡¥ï‡¥ø ‡¥é‡¥§‡µç‡¥∞ ‡¥¶‡¥ø‡¥µ‡¥∏‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥é‡¥§‡µç‡¥∞ ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥Æ‡¥§‡¥ø‡¥Ø‡µÜ‡¥®‡µç‡¥®‡µç ‡¥ï‡¥æ‡¥£‡¥æ‡¥Ç.\nFor irrigation planning, open the "Irrigation" module. Give crop, growth stage, soil type and rain chance to see a simple water requirement and frequency.';
    }

    // Pest / disease questions
    if (
      lower.includes('pest') || lower.includes('disease') ||
      lower.includes('insect') || lower.includes('worm') ||
      lower.includes('leaf spot') || lower.includes('yellow leaf') ||
      lower.includes('‡¥ï‡µÄ‡¥ü‡¥Ç') || lower.includes('‡¥∞‡µã‡¥ó‡¥Ç')
    ) {
      return '‡¥ï‡µÄ‡¥ü-‡¥∞‡µã‡¥ó ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡¥ø‡¥®‡µç "Pest & Disease" ‡¥Æ‡µã‡¥°‡µç‡¥Ø‡µÇ‡µæ ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï. ‡¥Ö‡¥µ‡¥ø‡¥ü‡µÜ ‡¥µ‡¥ø‡¥≥‡¥Ø‡µÅ‡¥Ç ‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥ü‡µà‡¥™‡µç‡¥™‡µç ‡¥ö‡µÜ‡¥Ø‡µç‚Äå‡¥§‡¥æ‡µΩ ‡¥í‡¥∞‡µÅ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥® ‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥Ç ‡¥≤‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç. ‡¥ó‡µÅ‡¥∞‡µÅ‡¥§‡¥∞ ‡¥™‡µç‡¥∞‡¥∂‡µç‡¥®‡¥Ç ‡¥Ü‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Ö‡¥ü‡µÅ‡¥§‡µç‡¥§ Krishi Bhavan ‡¥¨‡¥®‡µç‡¥ß‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï.\nFor pest or disease doubts, use the "Pest & Disease" module. Type crop name and main symptoms to get a basic suggestion. For serious damage, contact your nearest Krishi Bhavan.';
    }

    // Market prices / selling
    if (
      lower.includes('price') || lower.includes('market') ||
      lower.includes('sell') || lower.includes('rate') ||
      lower.includes('‡¥µ‡¥ø‡¥≤') || lower.includes('‡¥ö‡¥®‡µç‡¥§')
    ) {
      return '‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÜ ‡¥µ‡¥ø‡¥™‡¥£‡¥ø ‡¥µ‡¥ø‡¥≤ ‡¥Ö‡¥±‡¥ø‡¥û‡µç‡¥û‡µç ‡¥®‡¥≤‡µç‡¥≤ ‡¥®‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡¥ø‡µΩ ‡¥µ‡¥ø‡µΩ‡¥ï‡µç‡¥ï‡¥æ‡µª "Market Prices" ‡¥Æ‡µã‡¥°‡µç‡¥Ø‡µÇ‡µæ ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï. ‡¥µ‡¥ø‡¥≥‡¥Ø‡µÅ‡¥Ç ‡¥ú‡¥ø‡¥≤‡µç‡¥≤‡¥Ø‡µÅ‡¥Ç ‡¥®‡µΩ‡¥ï‡¥ø‡¥Ø‡¥æ‡µΩ ‡¥∏‡¥Æ‡µÄ‡¥™ ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥ï‡¥≥‡¥ø‡¥≤‡µÜ ‡¥è‡¥ï‡¥¶‡µá‡¥∂ ‡¥µ‡¥ø‡¥≤‡¥ï‡µæ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç.\nTo check market prices and sell at better rates, open the "Market Prices" module. Enter crop and district to view approximate nearby market prices.';
    }

    // Schemes / subsidy / insurance
    if (lower.includes('scheme') || lower.includes('‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø')) {
      return '‡¥§‡¥æ‡¥ô‡µç‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥™‡¥ø.‡¥é‡¥Ç ‡¥ï‡¥ø‡¥∏‡¥æ‡µª ‡¥™‡µã‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞/‡¥∏‡¥Ç‡¥∏‡µç‡¥•‡¥æ‡¥® ‡¥ï‡µº‡¥∑‡¥ï ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥á‡µª‡¥∑‡µÅ‡¥±‡µª‡¥∏‡¥ø‡¥®‡µÅ‡¥Ç ‡¥Ö‡µº‡¥π‡¥§ ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡¥æ‡¥Ç. ‡¥Ö‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥≠‡¥µ‡¥®‡¥ø‡µΩ ‡¥¨‡¥®‡µç‡¥ß‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï.\nYou may be eligible for PM-KISAN and state crop insurance schemes. Please contact your nearest Krishi Bhavan.';
    }

    // Fallback: general guidance
    return '‡¥§‡¥æ‡¥ô‡µç‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥ï‡¥ø‡¥ü‡µç‡¥ü‡¥ø. ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡¥ø‡¥®‡¥æ‡¥Ø‡¥ø ‡¥á‡¥ü‡¥§‡µç ‡¥µ‡¥∂‡¥§‡µç‡¥§‡µÅ‡¥≥‡µç‡¥≥ ‡¥Æ‡µã‡¥°‡µç‡¥Ø‡µÇ‡¥≥‡µÅ‡¥ï‡µæ (Crop Advisor, Soil & Fertilizer, Irrigation, Market Prices, Schemes) ‡¥™‡¥ø‡¥®‡µç‡¥§‡µÅ‡¥ü‡¥∞‡µÅ‡¥ï.\nI received your question. For more accurate help, please open the modules on the left like Crop Advisor, Soil & Fertilizer, Irrigation, Market Prices or Schemes based on your need.';
  }

  (function() {
    const chatWindow = document.getElementById('chatWindow');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');
    const langSelect = document.getElementById('languageSelect');

    let recognition = null;
    let recognizing = false;

    function appendMessage(sender, text) {
      const row = document.createElement('div');
      row.className = 'message-row ' + (sender === 'user' ? 'message-user' : 'message-assistant');

      const bubble = document.createElement('div');
      bubble.className = 'bubble ' + (sender === 'user' ? 'bubble-user' : 'bubble-assistant');
      bubble.textContent = text;

      row.appendChild(bubble);
      chatWindow.appendChild(row);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function speakText(text) {
      const synth = window.speechSynthesis;
      if (!synth) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = langSelect.value;
      synth.cancel();
      synth.speak(utterance);
    }

    function handleUserMessage(text, fromVoice = false) {
      const trimmed = text.trim();
      if (!trimmed) return;
      appendMessage('user', trimmed);
      userInput.value = '';

      // Simulate a slight delay like chat models
      setTimeout(() => {
        const reply = generateReply(trimmed);
        appendMessage('assistant', reply);
      }, fromVoice ? 800 : 400);
    }

    function initRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('Voice input is not supported in this browser. You can still type your questions below.');
        micBtn.disabled = true;
        return;
      }
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = langSelect.value;

      recognition.onstart = () => {
        recognizing = true;
        micBtn.disabled = true;
      };

      recognition.onend = () => {
        recognizing = false;
        micBtn.disabled = false;
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event);
        recognizing = false;
        micBtn.disabled = false;
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        // Put recognized text into the input so the farmer can check/correct
        // before sending. This avoids wrong messages due to mis-recognition.
        userInput.value = transcript;
        userInput.focus();
      };
    }

    // Initial assistant greeting
    appendMessage('assistant', '‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥û‡¥æ‡µª ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ï‡µº‡¥∑‡¥ï ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø ‡¥ö‡¥æ‡¥±‡µç‡¥±‡µç‚Äå‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥Ü‡¥£‡µç.\nHello! I am your farming assistant chatbot. Ask about crops, weather, soil, irrigation or schemes.');

    sendBtn.addEventListener('click', () => {
      handleUserMessage(userInput.value);
    });

    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleUserMessage(userInput.value);
      }
    });

    micBtn.addEventListener('click', () => {
      if (!recognition) {
        initRecognition();
        if (!recognition) return;
      }
      if (recognizing) {
        recognition.stop();
      } else {
        recognition.lang = langSelect.value;
        recognition.start();
      }
    });
  })();
</script>
{% endblock %}
